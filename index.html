<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Pro - MyWebAR Style</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <style>
        :root { --accent: #007aff; --bg: #050505; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; }
        
        /* Admin/Dashboard UI */
        .admin-box { max-width: 450px; margin: 50px auto; padding: 30px; background: #111; border-radius: 20px; border: 1px solid #333; }
        input { width: 100%; padding: 15px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 10px; box-sizing: border-box; }
        .btn { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
        #link-section { display: none; margin-top: 25px; padding: 20px; background: #1c1c1e; border-radius: 15px; border: 1px dashed var(--accent); }
        #final-link { color: var(--accent); word-break: break-all; font-size: 13px; display: block; margin: 10px 0; }

        /* AR Viewer Page UI */
        #ar-page { display: none; width: 100vw; height: 100vh; background: #000; flex-direction: column; align-items: center; justify-content: center; }
        .ar-card { background: #111; padding: 40px 20px; border-radius: 25px; width: 85%; max-width: 400px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ar-icon { font-size: 50px; margin-bottom: 20px; }
        .launch-btn { background: var(--accent); color: white; padding: 20px 40px; border-radius: 50px; border: none; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,122,255,0.4); margin-top: 20px; }
        
        /* Model Viewer Hidden Initially */
        model-viewer { width: 100%; height: 100%; display: none; }
    </style>
</head>
<body>

<div id="setup-ui">
    <div class="admin-box">
        <h2 style="color:var(--accent)">AR Link Generator</h2>
        <input type="text" id="p-name" placeholder="Project Title">
        <input type="file" id="p-file" accept=".glb">
        <button class="btn" onclick="publish()">Generate MyWebAR Link</button>
        <div id="status" style="margin-top: 15px; font-size: 13px; opacity: 0.6;">Upload any .glb file</div>

        <div id="link-section">
            <p style="font-weight:bold;">Direct AR Link:</p>
            <span id="final-link"></span>
            <button class="btn" style="background:#28a745" onclick="copyLink()">Copy Link</button>
        </div>
    </div>
</div>

<div id="ar-page">
    <div class="ar-card" id="launcher-card">
        <div class="ar-icon">üßä</div>
        <h2 id="project-title-display">AR Experience</h2>
        <p style="opacity: 0.7; font-size: 14px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡ßá‡¶∂‡ßá ‡¶Æ‡¶°‡ßá‡¶≤‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        <button class="launch-btn" onclick="startAR()">VIEW IN AR</button>
    </div>
    
    <model-viewer id="viewer" src="" ar ar-modes="webxr scene-viewer quick-look" camera-controls ar-placement="floor" shadow-intensity="1">
        <button slot="ar-button" id="real-ar-btn" style="display:none;"></button>
    </model-viewer>
</div>

<script>
    const CLOUD = "dgn3gfiaf"; 
    const PRESET = "my_ar_preset"; 

    async function publish() {
        const file = document.getElementById('p-file').files[0];
        const name = document.getElementById('p-name').value;
        const status = document.getElementById('status');
        if(!file || !name) return alert("Select file and enter name!");

        status.innerText = "‚è≥ Uploading... Please wait.";
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', PRESET);

        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD}/auto/upload`, { method: 'POST', body: formData });
            const data = await res.json();
            if(data.secure_url) {
                const link = window.location.origin + window.location.pathname + "?view=" + encodeURIComponent(data.secure_url) + "&n=" + encodeURIComponent(name);
                document.getElementById('link-section').style.display = "block";
                document.getElementById('final-link').innerText = link;
                status.innerHTML = "‚úÖ <span style='color:#28a745'>Ready!</span>";
            }
        } catch(e) { status.innerText = "‚ùå Connection Failed"; }
    }

    function copyLink() {
        navigator.clipboard.writeText(document.getElementById('final-link').innerText);
        alert("Link Copied!");
    }

    // AR PAGE LOGIC
    const params = new URLSearchParams(window.location.search);
    const modelUrl = params.get('view');
    const projName = params.get('n');

    if(modelUrl) {
        document.getElementById('setup-ui').style.display = 'none';
        document.getElementById('ar-page').style.display = 'flex';
        document.getElementById('project-title-display').innerText = projName || "AR Experience";
        document.getElementById('viewer').src = modelUrl;
    }

    function startAR() {
        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶≠‡¶ø‡¶â‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶∏‡¶≤ AR ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá
        const arBtn = document.getElementById('real-ar-btn');
        const viewer = document.getElementById('viewer');
        viewer.style.display = "block";
        document.getElementById('launcher-card').style.display = "none";
        
        // ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶≠‡¶ø‡¶â‡ßü‡¶æ‡¶∞ ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        viewer.activateAR();
    }
</script>
</body>
</html>
