<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Universal WebAR - Final Fix</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        #overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #0a0a0b; z-index: 100; }
        .box { background: #161618; padding: 40px; border-radius: 25px; text-align: center; border: 1px solid #333; width: 80%; max-width: 350px; }
        .btn { background: #007aff; color: white; padding: 20px; border: none; border-radius: 15px; font-weight: bold; width: 100%; font-size: 16px; cursor: pointer; box-shadow: 0 10px 20px rgba(0,122,255,0.3); }
        #instructions { position: fixed; bottom: 20px; width: 100%; text-align: center; color: white; z-index: 10; display: none; }
        #instructions p { background: rgba(0,0,0,0.7); display: inline-block; padding: 10px 20px; border-radius: 20px; font-size: 13px; }
    </style>
</head>
<body>

<div id="overlay">
    <div class="box">
        <h2 style="color:#007aff; margin-top:0;">AR Experience</h2>
        <p style="color:#888; font-size:14px; margin-bottom:25px;">বাটনে ক্লিক করলে সরাসরি ক্যামেরা ওপেন হবে। কোনো ৩ডি ভাসমান প্রিভিউ আসবে না।</p>
        <button class="btn" onclick="startAR()">START CAMERA</button>
    </div>
</div>

<div id="instructions"><p>ফোনটি চারপাশে ঘোরান মডেলটি দেখার জন্য</p></div>

<script>
    const params = new URLSearchParams(window.location.search);
    const modelUrl = params.get('view');

    function startAR() {
        if (!modelUrl) return alert("Model URL not found!");

        // Requesting Motion Sensor access (Essential for non-ARCore phones)
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        initScene();
                    } else {
                        alert("Sensor access denied!");
                    }
                })
                .catch(console.error);
        } else {
            initScene();
        }
    }

    function initScene() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('instructions').style.display = 'block';

        // Direct Camera Injection without SLAM dependency
        const sceneHtml = `
            <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
                <a-assets>
                    <a-asset-item id="model" src="${modelUrl}"></a-asset-item>
                </a-assets>

                <a-entity position="0 0 -4">
                    <a-entity gltf-model="#model" scale="1 1 1" rotation="0 45 0"></a-entity>
                </a-entity>

                <a-entity light="type: ambient; intensity: 1.5;"></a-entity>
                <a-entity light="type: directional; intensity: 1;" position="1 2 1"></a-entity>
                
                <a-camera look-controls="enabled: true; magicWindowTrackingEnabled: true;"></a-camera>
            </a-scene>
        `;
        document.body.insertAdjacentHTML('beforeend', sceneHtml);
    }
</script>
</body>
</html>
