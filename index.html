<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Cloud AR Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; padding: 20px; }
        .box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        .btn { background: #007bff; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        #loading { color: #555; margin-top: 15px; display: none; }
        #qrcode { margin-top: 20px; display: flex; justify-content: center; }
    </style>
</head>
<body>
<div id="ui-panel" class="box">
    <h2>üì¶ 3D Model Uploader</h2>
    <p>‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
    <input type="file" id="model-file" accept=".glb" style="width: 100%;">
    <button class="btn" onclick="uploadModel()">‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <div id="loading">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    <div id="qr-result"></div>
</div>
<script>
    const CLOUD_NAME = "dgn3gfiaf"; 
    const API_KEY = "781113676476835"; 
    const UPLOAD_PRESET = "my_ar_preset"; 

    async function uploadModel() {
        const file = document.getElementById('model-file').files[0];
        const loading = document.getElementById('loading');
        const qrResult = document.getElementById('qr-result');
        if(!file) return alert("‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®!");
        loading.style.display = "block";
        qrResult.innerHTML = "";
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', UPLOAD_PRESET);
        formData.append('api_key', API_KEY);
        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
                method: 'POST', body: formData
            });
            const data = await res.json();
            if(data.secure_url) {
                const finalUrl = window.location.origin + window.location.pathname + "?model=" + encodeURIComponent(data.secure_url);
                loading.innerHTML = "<b style='color:green;'>‚úÖ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∏‡¶´‡¶≤!</b>";
                qrResult.innerHTML = "<p>QR ‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</p><div id='qrcode'></div>";
                new QRCode(document.getElementById("qrcode"), { text: finalUrl, width: 200, height: 200 });
            } else { alert("Cloudinary 'Unsigned' ‡¶™‡ßç‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); }
        } catch (err) { alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞!"); }
    }
    const modelParam = new URLSearchParams(window.location.search).get('model');
    if(modelParam) {
        document.getElementById('ui-panel').style.display = 'none';
        document.body.innerHTML = `
            <model-viewer src="${modelParam}" ar ar-modes="webxr scene-viewer quick-look" camera-controls auto-rotate style="width: 100vw; height: 100vh;">
                <button slot="ar-button" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 50px; font-weight: bold;">üëã ‡¶è‡¶Ü‡¶∞-‡¶è ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
            </model-viewer>`;
    }
</script>
</body>
</html>


